<html>
<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-0WF2TZ0X6S"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-0WF2TZ0X6S');
    </script>
    <title>Nim</title>
    
    <meta charset='UTF-8'>
    <meta content='width=device-width, initial-scale=1' name='viewport'/>

    <meta name='description' content='How to play Nim perfectly using mathematical strategy. An introduction to proofs in combinatorial game theory with interactive examples and XOR strategy explained.'>
	<meta name='keywords' content='nim game, combinatorial game theory, game strategy, nim strategy, xor strategy, mathematical games, game theory proofs, perfect play, winning strategy'>
    <meta name='author' content='Chase K Osborne'>

    <!-- Canonical URL -->
    <link rel='canonical' href='https://chasekosborne.github.io/blog/nim.html' />

    <!-- Open Graph / Facebook -->
    <meta property='og:type' content='article'>
    <meta property='og:url' content='https://chasekosborne.github.io/blog/nim.html'>
    <meta property='og:title' content='Beating Nim'>
    <meta property='og:description' content='How to play Nim perfectly using mathematical strategy. An introduction to proofs in combinatorial game theory.'>
    <meta property='og:image' content='https://chasekosborne.github.io/image/nim/diagram1.png'>
    <meta property='og:site_name' content='Chase K Osborne'>
    <meta property='article:published_time' content='2024-01-20'>
    <meta property='article:author' content='Chase K Osborne'>
    <meta property='article:section' content='Mathematics'>
    <meta property='article:tag' content='Game Theory'>
    <meta property='article:tag' content='Combinatorics'>

    <!-- Twitter Card -->
    <meta name='twitter:card' content='summary_large_image'>
    <meta name='twitter:url' content='https://chasekosborne.github.io/blog/nim.html'>
    <meta name='twitter:title' content='Beating Nim'>
    <meta name='twitter:description' content='How to play Nim perfectly using mathematical strategy and combinatorial game theory.'>
    <meta name='twitter:image' content='https://chasekosborne.github.io/image/nim/diagram1.png'>

    <!-- JSON-LD Structured Data -->
    <script type='application/ld+json'>
    {
      "@context": "https://schema.org",
      "@type": "BlogPosting",
      "headline": "Beating Nim",
      "description": "How to play Nim perfectly using mathematical strategy. An introduction to proofs in combinatorial game theory with interactive examples.",
      "image": "https://chasekosborne.github.io/image/nim/diagram1.png",
      "author": {
        "@type": "Person",
        "name": "Chase K Osborne",
        "url": "https://chasekosborne.github.io"
      },
      "publisher": {
        "@type": "Person",
        "name": "Chase K Osborne",
        "url": "https://chasekosborne.github.io"
      },
      "datePublished": "2024-01-20",
      "dateModified": "2024-01-20",
      "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://chasekosborne.github.io/blog/nim.html"
      }
    }
    </script>

    <link href='../css/blog.css' rel='stylesheet'/>
    <link href='../css/trac.css' rel='stylesheet'/>
    <link href='../css/markdown.css' rel='stylesheet'/>
    <link href='../css/nim.css' rel='stylesheet'>

    <link rel='shortcut icon' href='../image/favicon/favicon.png' />
    <script defer src="nim_logic.js"></script>
    <script type='text/x-mathjax-config'>
MathJax.Hub.Config({
  jax: ['input/TeX', 'output/HTML-CSS'],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
    extensions: ['color.js']
  },
  messageStyle: 'none',
  'HTML-CSS': { preferredFont: 'TeX', availableFonts: ['STIX','TeX'] }
});
</script>


  <script type='text/javascript'
          src='https://cdn.jsdelivr.net/npm/mathjax@3.0.0/es5/tex-mml-chtml.js'>
  </script>
  <!-- <script src='//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML' type='text/javascript'></script> -->

  
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">

<!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.3/dist/katex.min.css" integrity="sha384-ThssJ7YtjywV52Gj4JE/1SQEDoMEckXyhkFVwaf4nDSm5OBlXeedVYjuuUd0Yua+" crossorigin="anonymous"> -->
    
    <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-31890516-2"></script>
<script>
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-31890516-2');
</script>
</head>
<body>
<div class='content'>
    <div class='nav'>
    <ul class='wrap'>
        <li><a href='../index.html'>Home</a></li>
        <li><a href='../blog.html'>Blog</a></li>
    </ul>
</div>
    <div class='front-matter'>
        <div class='wrap'>
            <h1>Beating Nim</h1>
            <h4>
                
                How to play Nim perfectly, an introduction to proofs in combinatorial games.
                
            </h4>
            <div class='bylines'>
                <div class='byline'>
                    <h3>Published</h3>
                    <p>20 January 2025</p>
                </div>
            </div>
            <div class='clear'></div>
        </div>
    </div>
    <div class='wrap article'>
        <h2 id="Nim">The Game</h2>
        <p>
            Last semester I took a small course in proofwriting on some more intermediate topics, one of the proofs I was introduced to was about a turn based game called Nim.
            And it worked a little something like this:
        </p>
        <p>
            There are \( n \) rows/categories/sections, here in each row there are \( a_1, a_2, a_3, \ldots, a_n \) items (Could be stones, matchsticks, pencils, or whatever you like).
            Two players take turns removing items from the rows, and the player who removes the last item wins. An example game may look something like:
        </p>
        <div class="figure">
            <img src="../image/nim/diagram2.svg" alt="" style="width: 90%; display: block; margin: 0 auto;" />
            <div class="caption">
                <span class="caption-label">Figure. 1</span> Example game of Nim with three rows of items with 9, 5, and 7 items respectively. Player 2 removes the last item and wins the game.
            </div>
        </div>
        <p>
            In this example, player 2 wins. However, by design of the game, there is a strategy for the first player that, if played right, will guarantee a win for the first player always.
            What I am looking to do is go through this strategy and prove mathematically why this will guarantee a win.
        </p>
        <h2 id="Nim">The Strategy</h2>
        <p>
            When playing as the first player, the concept to keep in mind to win is the Nim sum. Each row has a number of items, and a binary representation of this number that is used to
            calculate this sum, by using the logical XOR operator (\( \oplus{} \)) with each binary representation of the number of items in each row. Using the example in Figure. 2. 
            The optimal game of Nim will look something like:
        </p>

        <div class="figure">
            <img src="../image/nim/diagram3.svg" alt="" style="width: 90%; display: block; margin: 0 auto;" />
            <div class="caption">
                <span class="caption-label">Figure. 2</span> Example game of Nim with starting configuration from Figure 1. In this case Player 1 removes the last item and wins the game, keeping the
                Nim sum at zero on his turns.
            </div>
        </div>
        <p>
            As we will prove later, so long as Player 1 plays the game optimally, this Nim sum will remain nonzero at the end of Player 2's turns no matter what move is made. And this is what allows for 
            Player 1 to win the game every time. No matter what.
        </p>
        <p>
            This is pretty interesting on its own. But outside of being a party trick, <i>how</i> exactly can one make sure that the Nim sum is 0 at the end of their turn? And why
            does this even work in the first place?
        </p>
        <p>
            To answer the first question, binary counting and operations are very unintuitive for humans to do quickly. So we will need to develop another method to keep track of our Nim sum.
            To do this, the first constraint we will need to put on ourselves is keeping track of how many groups of \( \{2, 4, 8, 16, ... ,2^{n}\} \) items are present in each row, considering only the 
            largest group \(2^{n}\) one can make for each row. For Player 1 to maintain their advantage, they need an even number of groups present for each configuration of row.
        </p>
        <div class="figure">
            <img src="../image/nim/diagram4.svg" alt="" style="width: 60%; display: block; margin: 0 auto;" />
            <div class="caption">
                <span class="caption-label">Figure. 3</span> Example game of Nim with starting configuration from Figure 1. Notice that we need to make sure that we have an even number of groups of 8.
        </div>
        <p>
            In the case of Figure 3 above, we will need to remove an item from the first row, given this rule alone we will need to remove at least five items so that we do not have an odd number of groups of eight,
            or four. But we must be careful, we can't just remove an arbitrary amount of items greater than four. We need to make sure that we are also treating the remainders, or lower powers of 2 properly as well.
            In this case, there are a few ways to think about or remembering how to do this. The best way is to try breaking these remainders further into groups, and just referring back to our inital rule and trying
            to balance this number so all groups are even, this works especially well for larger numbers of items.
        </p>
        <div class="figure">
            <img src="../image/nim/diagram5.svg" alt="" style="width: 80%; display: block; margin: 0 auto;" />
            <div class="caption">
                <span class="caption-label">Figure. 4</span> Algorithm of breaking down remainders into groups of powers of 2. Checking residuals recursively until an uneven number of groups is found.
        </div>
        <p>
            Doing this recursive check after each term will guarantee that the Nim sum is zero at the end of Player 1's turn. And this is the strategy that will allow for Player 1 to win every time. A short explanation of
            this comes about from the definition of the XOR operator. Since it works bitwise, and there are 3 numbers representing the number of items in binary, we only need to concern ourselves with 8 possible operations:
        </p>
            \[
                1 \oplus 1 \oplus 1 = 1 \\  
            \]
            \[
                1 \oplus 0 \oplus 0 = 1 \\
            \]
            \[
                0 \oplus 1 \oplus 0 = 1 \\
            \]
            \[
                0 \oplus 0 \oplus 1 = 1 \\
            \]
            \[ 
                1 \oplus 1 \oplus 0 = 0 \\
            \]
            \[
                1 \oplus 0 \oplus 1 = 0 \\
            \]
            \[
                0 \oplus 1 \oplus 1 = 0 \\
            \]
            \[
                0 \oplus 0 \oplus 0 = 0 \\
            \]
        <p>
            Note how the result of the operation is only zero when there are an even number of ones involved in the operation. This is exactly why we need to make sure that we have an even number of groups of each power of 2 in each row.
            As it maintains the condition that the XOR operator will output zero for each sum for all items and their binary representation. We will see that this condition will hold for games of all possible rows and item numbers.
        </p>
        </div>
        <h2 id="Proof">The Proof</h2>
        <p>
            To prove the winning strategy rigorously, we characterize game positions using the Sprague-Grundy theorem for impartial games.
            We define two types of positions:
        </p>
        <ul>
            <li><strong>P-positions</strong> (Previous player wins): Positions where the player who just moved has the advantage. The player to move will lose with optimal play.</li>
            <li><strong>N-positions</strong> (Next player wins): Positions where the player about to move has the advantage. The player to move will win with optimal play.</li>
        </ul>
        <p>
            <strong>Definition:</strong> For a game state with piles of sizes \(a_1, a_2, \ldots, a_n\), the <i>Nim sum</i> is defined as:
            \[
            S = a_1 \oplus a_2 \oplus \cdots \oplus a_n
            \]
            where \(\oplus\) denotes the bitwise XOR operation.
        </p>
        <p>
            <strong>Theorem:</strong> <i>A position in Nim is a P-position if and only if its Nim sum equals zero.</i>
        </p>
        <p>
            <strong>Proof:</strong> We establish this by showing three properties that uniquely characterize P-positions and N-positions:
        </p>
        <p>
            <strong>Property 1:</strong> <i>The terminal position is a P-position.</i>
        </p>
        <p>
            The terminal position has all piles empty: \(a_1 = a_2 = \cdots = a_n = 0\). The Nim sum is:
            \[
            S = 0 \oplus 0 \oplus \cdots \oplus 0 = 0
            \]
            The player to move cannot make any move and loses. Thus, the terminal position is a P-position with Nim sum zero.
        </p>
        <p>
            <strong>Property 2:</strong> <i>From any position with nonzero Nim sum (N-position), there exists at least one move to a position with zero Nim sum (P-position).</i>
        </p>
        <p>
            Let \(S = a_1 \oplus a_2 \oplus \cdots \oplus a_n \neq 0\). Let \(d\) be the position of the most significant bit (leftmost 1) in \(S\).
        </p>
        <p>
            Since \(S \neq 0\), there must be an odd number of piles with a 1 in bit position \(d\). Therefore, at least one pile \(a_k\) has a 1 in bit position \(d\).
        </p>
        <p>
            Consider the value \(a_k' = a_k \oplus S\). We claim that \(a_k' < a_k\):
        </p>
        <ul>
            <li>Both \(a_k\) and \(S\) have a 1 in bit position \(d\).</li>
            <li>Therefore, \(a_k \oplus S\) has a 0 in bit position \(d\).</li>
            <li>All bits more significant than \(d\) in \(S\) are 0 (by definition of \(d\)).</li>
            <li>Thus, \(a_k' = a_k \oplus S < a_k\) since the most significant differing bit is position \(d\), where \(a_k\) has 1 and \(a_k'\) has 0.</li>
        </ul>
        <p>
            Since \(a_k' < a_k\), reducing pile \(a_k\) to \(a_k'\) is a valid move. The new Nim sum after this move is:
            \[
            S' = a_1 \oplus \cdots \oplus a_k' \oplus \cdots \oplus a_n = a_1 \oplus \cdots \oplus (a_k \oplus S) \oplus \cdots \oplus a_n
            \]
            By associativity and commutativity of XOR:
            \[
            S' = (a_1 \oplus \cdots \oplus a_k \oplus \cdots \oplus a_n) \oplus S = S \oplus S = 0
            \]
            Thus, from any N-position, we can move to a P-position.
        </p>
        <p>
            <strong>Property 3:</strong> <i>From any position with zero Nim sum (P-position), every possible move leads to a position with nonzero Nim sum (N-position).</i>
        </p>
        <p>
            Let \(S = a_1 \oplus a_2 \oplus \cdots \oplus a_n = 0\). Suppose we reduce pile \(a_k\) to some value \(a_k'\) where \(a_k' < a_k\) (i.e., \(a_k' \neq a_k\)).
        </p>
        <p>
            The new Nim sum is:
            \[
            S' = a_1 \oplus \cdots \oplus a_k' \oplus \cdots \oplus a_n
            \]
            We can rewrite this using the fact that \(a_k = a_k \oplus 0 = a_k \oplus S\) (since \(S = 0\)):
            \[
            S' = S \oplus a_k \oplus a_k' = 0 \oplus a_k \oplus a_k' = a_k \oplus a_k'
            \]
            Since \(a_k' \neq a_k\), we have \(a_k \oplus a_k' \neq 0\), so \(S' \neq 0\).
        </p>
        <p>
            Thus, every move from a P-position leads to an N-position.
        </p>
        <p>
            <strong>Conclusion:</strong> Properties 1-3 establish that positions with Nim sum zero are exactly the P-positions:
        </p>
        <ul>
            <li>The game always terminates (piles decrease).</li>
            <li>The terminal state has Nim sum 0 (P-position).</li>
            <li>From Nim sum \(\neq 0\), one can always reach Nim sum \(= 0\).</li>
            <li>From Nim sum \(= 0\), one must reach Nim sum \(\neq 0\).</li>
        </ul>
        <p>
            Therefore, if the initial Nim sum is nonzero, the first player can always win by moving to a position with Nim sum zero, forcing the opponent into an N-to-P disadvantage on every turn.
        </p>
        <p style="text-align: right;">âˆŽ</p>
        <p>
            <strong>Corollary:</strong> <i>If the initial Nim sum is zero, the second player has a winning strategy.</i>
        </p>
        <p>
            This follows directly from the theorem: if the game starts in a P-position (Nim sum = 0), the first player must move to an N-position, giving the second player the winning advantage.
        </p>
        
        <h2 id="PlayNim">Play Nim</h2>
        <p>
            Try playing an interactive game of Nim below! The AI will play optimally against you.
        </p>
        
        <div id="nim-game">
            <div id="game-board"></div>
            <p>
                Select a row and the number of items to remove:
            </p>
            <button id="restart-button" style="margin-top: 20px; padding: 8px 16px;">
                Restart Game
            </button>
            <br><br>
        </div>
    </div>
    
        <div id='bibliography'>
            <div class='wrap'>
                <ol class="bibliography">
                <li><span id="ppjon">Charles L. Bouton. (1901). <a href="https://www.jstor.org/stable/1967631?seq=1" target="_blank">Nim, A Game with a Complete Mathematical Theory</a>. <i>Annals of Mathematics</i>, 3(1/4), 35-39. https://doi.org/10.2307/1967631
                </span></li>
            </div>
        </div>
</body>
</html>